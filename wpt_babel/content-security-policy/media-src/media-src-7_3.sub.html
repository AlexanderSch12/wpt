<!DOCTYPE HTML>
<html>
 <head>
  <title>
   Video track src attribute must match src list - positive test
  </title>
  <meta content="script-src * 'unsafe-inline'; media-src 'self' {{domains[www]}}:{{ports[http][0]}};" http-equiv="Content-Security-Policy"/>
  <script src="/resources/testharness.js">
  </script>
  <script src="/resources/testharnessreport.js">
  </script>
 </head>
 <body>
  <h1>
   Video track src attribute must match src list - positive test
  </h1>
  <div id="log">
  </div>
  <script>
   "use strict";

var source_test = async_test("In-policy track element");
var trackURL = location.protocol + "//{{domains[www]}}:{{ports[http][0]}}/media/foo.vtt";
var t_spv = async_test("Should not fire policy violation events");
var test_count = 1;
window.addEventListener("securitypolicyviolation", t_spv.unreached_func("Should not have fired any event"));
function media_loaded(t) {
  t.done();
  if (--test_count <= 0) {
    t_spv.done();
  }
}
function media_error_handler(t) {
  t.step(function () {
    assert_unreached("Error handler called for allowed track source.");
  });
  t.done();
}
  </script>
  <video controls="" crossorigin="" height="240" id="videoObject" onloadeddata="media_loaded(source_test)" width="320">
   <source id="audioSourceObject" src="/media/A4.ogv" type="audio/ogg"/>
   <track id="trackObject" kind="subtitles" label="English" onerror="media_error_handler(source_test)" srclang="en"/>
  </video>
  <script>
   "use strict";

document.getElementById("trackObject").src = trackURL;
  </script>
 </body>
</html>
